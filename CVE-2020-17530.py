#!/bin/python3
#coding=utf-8
import  tkinter as tk
import os 
from tkinter import scrolledtext

windows = tk.Tk()
windows.title("CVE-2020-17530")


'''
function exp_run(), execute vuln exp and insert the result list with output. Finally we can see result in result box.
'''
def exp_run(e, target, cmd):
    # execute exp 
    os_str = """python exp.py {} '{}'""".format(target, cmd)
    f = os.popen(os_str, 'r')
    
    # recieve the result list with exp output 
    res = f.readlines()	
    
    # clean the result box 
    e.delete('1.0','end')
    
    # if exp return is not null
    if(res):
        res.pop()

        # res is a list	
        #print(res)
        f.close()
        
        # insert result to result box
        for line in res:
            print(line.strip('\n'))
            e.insert('end',line)
            e.see('end')
            e.update()

#define 界面大小
windows.geometry("1000x768") 

#define target label
entry_var = tk.StringVar()
l_target =tk.Label(windows,text='目标地址：')
l_target.grid(row=0,column=0,sticky='w',)

# define target input box
e_target = tk.Entry(windows,show=None,textvariable=entry_var,width='70')
e_target.grid(row=0,column=1,sticky='w')
entry_var.set('如http://xxx:8080')

# define command execute box
l_cmd =tk.Label(windows,text='执行的命令：')
l_cmd.grid(row=1,column=0,sticky='w')
e_cmd = tk.Text(windows,show=None,width='70',height='3')
e_cmd.grid(row=1,column=1,sticky='w')

# define exec botton
b_exec = tk.Button(windows,text='命令执行',command=lambda:exp_run( e_output, e_target.get().strip(), e_cmd.get("0.0","end").strip()))
b_exec.grid(row=2,column=1,sticky='e')

# define result  box
e_output = scrolledtext.ScrolledText(windows, width='100', height='35')
e_output.grid(row=3,column=1)

# start tkinter 
windows.mainloop()

